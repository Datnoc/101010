"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/mambu/account/route";
exports.ids = ["app/api/mambu/account/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmambu%2Faccount%2Froute&page=%2Fapi%2Fmambu%2Faccount%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmambu%2Faccount%2Froute.ts&appDir=%2FUsers%2Femretutkun%2FDocuments%2FGitHub%2F101010%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Femretutkun%2FDocuments%2FGitHub%2F101010&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmambu%2Faccount%2Froute&page=%2Fapi%2Fmambu%2Faccount%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmambu%2Faccount%2Froute.ts&appDir=%2FUsers%2Femretutkun%2FDocuments%2FGitHub%2F101010%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Femretutkun%2FDocuments%2FGitHub%2F101010&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_emretutkun_Documents_GitHub_101010_app_api_mambu_account_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/mambu/account/route.ts */ \"(rsc)/./app/api/mambu/account/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/mambu/account/route\",\n        pathname: \"/api/mambu/account\",\n        filename: \"route\",\n        bundlePath: \"app/api/mambu/account/route\"\n    },\n    resolvedPagePath: \"/Users/emretutkun/Documents/GitHub/101010/app/api/mambu/account/route.ts\",\n    nextConfigOutput,\n    userland: _Users_emretutkun_Documents_GitHub_101010_app_api_mambu_account_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/mambu/account/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZtYW1idSUyRmFjY291bnQlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRm1hbWJ1JTJGYWNjb3VudCUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRm1hbWJ1JTJGYWNjb3VudCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmVtcmV0dXRrdW4lMkZEb2N1bWVudHMlMkZHaXRIdWIlMkYxMDEwMTAlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGZW1yZXR1dGt1biUyRkRvY3VtZW50cyUyRkdpdEh1YiUyRjEwMTAxMCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDd0I7QUFDckc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kYXRwYXkvP2QwYzUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL2VtcmV0dXRrdW4vRG9jdW1lbnRzL0dpdEh1Yi8xMDEwMTAvYXBwL2FwaS9tYW1idS9hY2NvdW50L3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9tYW1idS9hY2NvdW50L3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvbWFtYnUvYWNjb3VudFwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvbWFtYnUvYWNjb3VudC9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9lbXJldHV0a3VuL0RvY3VtZW50cy9HaXRIdWIvMTAxMDEwL2FwcC9hcGkvbWFtYnUvYWNjb3VudC9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvbWFtYnUvYWNjb3VudC9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmambu%2Faccount%2Froute&page=%2Fapi%2Fmambu%2Faccount%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmambu%2Faccount%2Froute.ts&appDir=%2FUsers%2Femretutkun%2FDocuments%2FGitHub%2F101010%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Femretutkun%2FDocuments%2FGitHub%2F101010&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/mambu/account/route.ts":
/*!****************************************!*\
  !*** ./app/api/mambu/account/route.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_mambu__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/mambu */ \"(rsc)/./lib/mambu.ts\");\n\n\nasync function GET(request) {\n    try {\n        if (!(0,_lib_mambu__WEBPACK_IMPORTED_MODULE_1__.isMambuConfigured)()) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Mambu yapılandırması eksik\"\n            }, {\n                status: 500\n            });\n        }\n        const { searchParams } = new URL(request.url);\n        const email = searchParams.get(\"email\");\n        if (!email) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Email gereklidir\"\n            }, {\n                status: 400\n            });\n        }\n        // Client'ı bul\n        const client = await (0,_lib_mambu__WEBPACK_IMPORTED_MODULE_1__.findClientByEmail)(email);\n        // Client bulunamazsa sessizce boş data döndür (404 hatası verme)\n        if (!client || !client[0]) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                account: {\n                    clientId: null,\n                    totalBalance: 0,\n                    cashBalance: 0,\n                    accounts: [],\n                    loans: [],\n                    totalLoanBalance: 0,\n                    creditCardDebt: 0\n                }\n            });\n        }\n        const clientData = client[0];\n        const clientId = clientData.encodedKey || clientData.id;\n        // Client'ın account'larını al (deposit accounts, savings accounts, etc.)\n        // Mambu API'den account bilgilerini çek\n        try {\n            const accountsUrl = `${process.env.MAMBU_BASE_URL}/api/deposits?clientId=${clientId}`;\n            const accountsResponse = await fetch(accountsUrl, {\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"Accept\": \"application/vnd.mambu.v2+json\",\n                    \"apiKey\": process.env.MAMBU_API_KEY || \"\"\n                }\n            });\n            let accounts = [];\n            let totalBalance = 0;\n            let cashBalance = 0;\n            if (accountsResponse.ok) {\n                const accountsData = await accountsResponse.json();\n                const rawAccounts = Array.isArray(accountsData) ? accountsData : [];\n                // Accounts array'ini map et ve accountNumber field'ını ekle\n                accounts = rawAccounts.map((acc)=>({\n                        id: acc.id || acc.encodedKey || \"\",\n                        accountNumber: acc.accountNumber || acc.id || acc.encodedKey || \"\",\n                        accountType: acc.accountType || acc.productTypeKey || \"DEPOSIT\",\n                        currencyCode: acc.currencyCode || \"USD\",\n                        balance: parseFloat(acc.balance || acc.availableBalance || \"0\"),\n                        availableBalance: parseFloat(acc.availableBalance || acc.balance || \"0\"),\n                        accountState: acc.accountState || acc.state || \"ACTIVE\"\n                    }));\n                // Toplam bakiyeyi hesapla\n                accounts.forEach((acc)=>{\n                    const balance = parseFloat(acc.balance || acc.availableBalance || \"0\");\n                    totalBalance += balance;\n                    cashBalance += balance; // Mambu'dan gelen nakit\n                });\n            }\n            // Loan (kredi) verilerini al\n            let loans = [];\n            let totalLoanBalance = 0;\n            try {\n                const loansUrl = `${process.env.MAMBU_BASE_URL}/api/loans?clientId=${clientId}`;\n                const loansResponse = await fetch(loansUrl, {\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"Accept\": \"application/vnd.mambu.v2+json\",\n                        \"apiKey\": process.env.MAMBU_API_KEY || \"\"\n                    }\n                });\n                if (loansResponse.ok) {\n                    const loansData = await loansResponse.json();\n                    loans = Array.isArray(loansData) ? loansData : [];\n                    // Toplam kredi bakiyesini hesapla (borç)\n                    loans.forEach((loan)=>{\n                        const principalBalance = parseFloat(loan.principalBalance || loan.balance || \"0\");\n                        totalLoanBalance += principalBalance;\n                    });\n                }\n            } catch (error) {\n                console.warn(\"Mambu loans fetch error:\", error);\n            }\n            // Kredi kartı borcu verilerini al (credit arrangements veya credit card loans)\n            let creditCardDebt = 0;\n            try {\n                // Kredi kartları genellikle loan product type'ı CREDIT_CARD olan loan'lar olabilir\n                const creditCardsUrl = `${process.env.MAMBU_BASE_URL}/api/loans?clientId=${clientId}&loanProductType=CREDIT_CARD`;\n                const creditCardsResponse = await fetch(creditCardsUrl, {\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"Accept\": \"application/vnd.mambu.v2+json\",\n                        \"apiKey\": process.env.MAMBU_API_KEY || \"\"\n                    }\n                });\n                if (creditCardsResponse.ok) {\n                    const creditCardsData = await creditCardsResponse.json();\n                    const creditCardLoans = Array.isArray(creditCardsData) ? creditCardsData : [];\n                    creditCardLoans.forEach((card)=>{\n                        const balance = parseFloat(card.principalBalance || card.balance || card.availableCredit || \"0\");\n                        creditCardDebt += balance;\n                    });\n                }\n            } catch (error) {\n                console.warn(\"Mambu credit cards fetch error:\", error);\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                account: {\n                    clientId: clientId,\n                    totalBalance: totalBalance,\n                    cashBalance: cashBalance,\n                    accounts: accounts,\n                    loans: loans,\n                    totalLoanBalance: totalLoanBalance,\n                    creditCardDebt: creditCardDebt\n                }\n            });\n        } catch (error) {\n            console.error(\"Mambu account error:\", error);\n            // Hata durumunda da client bilgisini döndür\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                account: {\n                    clientId: clientId,\n                    totalBalance: 0,\n                    cashBalance: 0,\n                    accounts: [],\n                    loans: [],\n                    totalLoanBalance: 0,\n                    creditCardDebt: 0\n                }\n            });\n        }\n    } catch (error) {\n        console.error(\"Mambu account error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Hesap bilgileri alınamadı\",\n            message: error.message || \"Bilinmeyen hata\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZGF0cGF5Ly4vYXBwL2FwaS9tYW1idS9hY2NvdW50L3JvdXRlLnRzPzEwMmYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IGZpbmRDbGllbnRCeUVtYWlsLCBpc01hbWJ1Q29uZmlndXJlZCB9IGZyb20gJ0AvbGliL21hbWJ1JztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGlmICghaXNNYW1idUNvbmZpZ3VyZWQoKSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnTWFtYnUgeWFwxLFsYW5kxLFybWFzxLEgZWtzaWsnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XG4gICAgY29uc3QgZW1haWwgPSBzZWFyY2hQYXJhbXMuZ2V0KCdlbWFpbCcpO1xuXG4gICAgaWYgKCFlbWFpbCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnRW1haWwgZ2VyZWtsaWRpcicgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIENsaWVudCfEsSBidWxcbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBmaW5kQ2xpZW50QnlFbWFpbChlbWFpbCk7XG4gICAgXG4gICAgICAvLyBDbGllbnQgYnVsdW5hbWF6c2Egc2Vzc2l6Y2UgYm/FnyBkYXRhIGTDtm5kw7xyICg0MDQgaGF0YXPEsSB2ZXJtZSlcbiAgICAgIGlmICghY2xpZW50IHx8ICFjbGllbnRbMF0pIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIGFjY291bnQ6IHtcbiAgICAgICAgICAgIGNsaWVudElkOiBudWxsLFxuICAgICAgICAgICAgdG90YWxCYWxhbmNlOiAwLFxuICAgICAgICAgICAgY2FzaEJhbGFuY2U6IDAsXG4gICAgICAgICAgICBhY2NvdW50czogW10sXG4gICAgICAgICAgICBsb2FuczogW10sXG4gICAgICAgICAgICB0b3RhbExvYW5CYWxhbmNlOiAwLFxuICAgICAgICAgICAgY3JlZGl0Q2FyZERlYnQ6IDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICBjb25zdCBjbGllbnREYXRhID0gY2xpZW50WzBdO1xuICAgIGNvbnN0IGNsaWVudElkID0gY2xpZW50RGF0YS5lbmNvZGVkS2V5IHx8IGNsaWVudERhdGEuaWQ7XG5cbiAgICAvLyBDbGllbnQnxLFuIGFjY291bnQnbGFyxLFuxLEgYWwgKGRlcG9zaXQgYWNjb3VudHMsIHNhdmluZ3MgYWNjb3VudHMsIGV0Yy4pXG4gICAgLy8gTWFtYnUgQVBJJ2RlbiBhY2NvdW50IGJpbGdpbGVyaW5pIMOnZWtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYWNjb3VudHNVcmwgPSBgJHtwcm9jZXNzLmVudi5NQU1CVV9CQVNFX1VSTH0vYXBpL2RlcG9zaXRzP2NsaWVudElkPSR7Y2xpZW50SWR9YDtcbiAgICAgIGNvbnN0IGFjY291bnRzUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChhY2NvdW50c1VybCwge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL3ZuZC5tYW1idS52Mitqc29uJyxcbiAgICAgICAgICAnYXBpS2V5JzogcHJvY2Vzcy5lbnYuTUFNQlVfQVBJX0tFWSB8fCAnJyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBsZXQgYWNjb3VudHM6IGFueVtdID0gW107XG4gICAgICBsZXQgdG90YWxCYWxhbmNlID0gMDtcbiAgICAgIGxldCBjYXNoQmFsYW5jZSA9IDA7XG5cbiAgICAgIGlmIChhY2NvdW50c1Jlc3BvbnNlLm9rKSB7XG4gICAgICAgIGNvbnN0IGFjY291bnRzRGF0YSA9IGF3YWl0IGFjY291bnRzUmVzcG9uc2UuanNvbigpO1xuICAgICAgICBjb25zdCByYXdBY2NvdW50cyA9IEFycmF5LmlzQXJyYXkoYWNjb3VudHNEYXRhKSA/IGFjY291bnRzRGF0YSA6IFtdO1xuICAgICAgICBcbiAgICAgICAgLy8gQWNjb3VudHMgYXJyYXknaW5pIG1hcCBldCB2ZSBhY2NvdW50TnVtYmVyIGZpZWxkJ8SxbsSxIGVrbGVcbiAgICAgICAgYWNjb3VudHMgPSByYXdBY2NvdW50cy5tYXAoKGFjYzogYW55KSA9PiAoe1xuICAgICAgICAgIGlkOiBhY2MuaWQgfHwgYWNjLmVuY29kZWRLZXkgfHwgJycsXG4gICAgICAgICAgYWNjb3VudE51bWJlcjogYWNjLmFjY291bnROdW1iZXIgfHwgYWNjLmlkIHx8IGFjYy5lbmNvZGVkS2V5IHx8ICcnLFxuICAgICAgICAgIGFjY291bnRUeXBlOiBhY2MuYWNjb3VudFR5cGUgfHwgYWNjLnByb2R1Y3RUeXBlS2V5IHx8ICdERVBPU0lUJyxcbiAgICAgICAgICBjdXJyZW5jeUNvZGU6IGFjYy5jdXJyZW5jeUNvZGUgfHwgJ1VTRCcsXG4gICAgICAgICAgYmFsYW5jZTogcGFyc2VGbG9hdChhY2MuYmFsYW5jZSB8fCBhY2MuYXZhaWxhYmxlQmFsYW5jZSB8fCAnMCcpLFxuICAgICAgICAgIGF2YWlsYWJsZUJhbGFuY2U6IHBhcnNlRmxvYXQoYWNjLmF2YWlsYWJsZUJhbGFuY2UgfHwgYWNjLmJhbGFuY2UgfHwgJzAnKSxcbiAgICAgICAgICBhY2NvdW50U3RhdGU6IGFjYy5hY2NvdW50U3RhdGUgfHwgYWNjLnN0YXRlIHx8ICdBQ1RJVkUnLFxuICAgICAgICB9KSk7XG4gICAgICAgIFxuICAgICAgICAvLyBUb3BsYW0gYmFraXlleWkgaGVzYXBsYVxuICAgICAgICBhY2NvdW50cy5mb3JFYWNoKChhY2M6IGFueSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGJhbGFuY2UgPSBwYXJzZUZsb2F0KGFjYy5iYWxhbmNlIHx8IGFjYy5hdmFpbGFibGVCYWxhbmNlIHx8ICcwJyk7XG4gICAgICAgICAgdG90YWxCYWxhbmNlICs9IGJhbGFuY2U7XG4gICAgICAgICAgY2FzaEJhbGFuY2UgKz0gYmFsYW5jZTsgLy8gTWFtYnUnZGFuIGdlbGVuIG5ha2l0XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBMb2FuIChrcmVkaSkgdmVyaWxlcmluaSBhbFxuICAgICAgbGV0IGxvYW5zID0gW107XG4gICAgICBsZXQgdG90YWxMb2FuQmFsYW5jZSA9IDA7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBsb2Fuc1VybCA9IGAke3Byb2Nlc3MuZW52Lk1BTUJVX0JBU0VfVVJMfS9hcGkvbG9hbnM/Y2xpZW50SWQ9JHtjbGllbnRJZH1gO1xuICAgICAgICBjb25zdCBsb2Fuc1Jlc3BvbnNlID0gYXdhaXQgZmV0Y2gobG9hbnNVcmwsIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi92bmQubWFtYnUudjIranNvbicsXG4gICAgICAgICAgICAnYXBpS2V5JzogcHJvY2Vzcy5lbnYuTUFNQlVfQVBJX0tFWSB8fCAnJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAobG9hbnNSZXNwb25zZS5vaykge1xuICAgICAgICAgIGNvbnN0IGxvYW5zRGF0YSA9IGF3YWl0IGxvYW5zUmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgIGxvYW5zID0gQXJyYXkuaXNBcnJheShsb2Fuc0RhdGEpID8gbG9hbnNEYXRhIDogW107XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVG9wbGFtIGtyZWRpIGJha2l5ZXNpbmkgaGVzYXBsYSAoYm9yw6cpXG4gICAgICAgICAgbG9hbnMuZm9yRWFjaCgobG9hbjogYW55KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBwcmluY2lwYWxCYWxhbmNlID0gcGFyc2VGbG9hdChsb2FuLnByaW5jaXBhbEJhbGFuY2UgfHwgbG9hbi5iYWxhbmNlIHx8ICcwJyk7XG4gICAgICAgICAgICB0b3RhbExvYW5CYWxhbmNlICs9IHByaW5jaXBhbEJhbGFuY2U7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignTWFtYnUgbG9hbnMgZmV0Y2ggZXJyb3I6JywgZXJyb3IpO1xuICAgICAgfVxuXG4gICAgICAvLyBLcmVkaSBrYXJ0xLEgYm9yY3UgdmVyaWxlcmluaSBhbCAoY3JlZGl0IGFycmFuZ2VtZW50cyB2ZXlhIGNyZWRpdCBjYXJkIGxvYW5zKVxuICAgICAgbGV0IGNyZWRpdENhcmREZWJ0ID0gMDtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIEtyZWRpIGthcnRsYXLEsSBnZW5lbGxpa2xlIGxvYW4gcHJvZHVjdCB0eXBlJ8SxIENSRURJVF9DQVJEIG9sYW4gbG9hbidsYXIgb2xhYmlsaXJcbiAgICAgICAgY29uc3QgY3JlZGl0Q2FyZHNVcmwgPSBgJHtwcm9jZXNzLmVudi5NQU1CVV9CQVNFX1VSTH0vYXBpL2xvYW5zP2NsaWVudElkPSR7Y2xpZW50SWR9JmxvYW5Qcm9kdWN0VHlwZT1DUkVESVRfQ0FSRGA7XG4gICAgICAgIGNvbnN0IGNyZWRpdENhcmRzUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChjcmVkaXRDYXJkc1VybCwge1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL3ZuZC5tYW1idS52Mitqc29uJyxcbiAgICAgICAgICAgICdhcGlLZXknOiBwcm9jZXNzLmVudi5NQU1CVV9BUElfS0VZIHx8ICcnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChjcmVkaXRDYXJkc1Jlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgY29uc3QgY3JlZGl0Q2FyZHNEYXRhID0gYXdhaXQgY3JlZGl0Q2FyZHNSZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgY29uc3QgY3JlZGl0Q2FyZExvYW5zID0gQXJyYXkuaXNBcnJheShjcmVkaXRDYXJkc0RhdGEpID8gY3JlZGl0Q2FyZHNEYXRhIDogW107XG4gICAgICAgICAgXG4gICAgICAgICAgY3JlZGl0Q2FyZExvYW5zLmZvckVhY2goKGNhcmQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYmFsYW5jZSA9IHBhcnNlRmxvYXQoY2FyZC5wcmluY2lwYWxCYWxhbmNlIHx8IGNhcmQuYmFsYW5jZSB8fCBjYXJkLmF2YWlsYWJsZUNyZWRpdCB8fCAnMCcpO1xuICAgICAgICAgICAgY3JlZGl0Q2FyZERlYnQgKz0gYmFsYW5jZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdNYW1idSBjcmVkaXQgY2FyZHMgZmV0Y2ggZXJyb3I6JywgZXJyb3IpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBhY2NvdW50OiB7XG4gICAgICAgICAgY2xpZW50SWQ6IGNsaWVudElkLFxuICAgICAgICAgIHRvdGFsQmFsYW5jZTogdG90YWxCYWxhbmNlLFxuICAgICAgICAgIGNhc2hCYWxhbmNlOiBjYXNoQmFsYW5jZSxcbiAgICAgICAgICBhY2NvdW50czogYWNjb3VudHMsXG4gICAgICAgICAgbG9hbnM6IGxvYW5zLFxuICAgICAgICAgIHRvdGFsTG9hbkJhbGFuY2U6IHRvdGFsTG9hbkJhbGFuY2UsXG4gICAgICAgICAgY3JlZGl0Q2FyZERlYnQ6IGNyZWRpdENhcmREZWJ0LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcignTWFtYnUgYWNjb3VudCBlcnJvcjonLCBlcnJvcik7XG4gICAgICAvLyBIYXRhIGR1cnVtdW5kYSBkYSBjbGllbnQgYmlsZ2lzaW5pIGTDtm5kw7xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBhY2NvdW50OiB7XG4gICAgICAgICAgY2xpZW50SWQ6IGNsaWVudElkLFxuICAgICAgICAgIHRvdGFsQmFsYW5jZTogMCxcbiAgICAgICAgICBjYXNoQmFsYW5jZTogMCxcbiAgICAgICAgICBhY2NvdW50czogW10sXG4gICAgICAgICAgbG9hbnM6IFtdLFxuICAgICAgICAgIHRvdGFsTG9hbkJhbGFuY2U6IDAsXG4gICAgICAgICAgY3JlZGl0Q2FyZERlYnQ6IDAsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdNYW1idSBhY2NvdW50IGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IFxuICAgICAgICBlcnJvcjogJ0hlc2FwIGJpbGdpbGVyaSBhbMSxbmFtYWTEsScsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0JpbGlubWV5ZW4gaGF0YSdcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJmaW5kQ2xpZW50QnlFbWFpbCIsImlzTWFtYnVDb25maWd1cmVkIiwiR0VUIiwicmVxdWVzdCIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsImVtYWlsIiwiZ2V0IiwiY2xpZW50Iiwic3VjY2VzcyIsImFjY291bnQiLCJjbGllbnRJZCIsInRvdGFsQmFsYW5jZSIsImNhc2hCYWxhbmNlIiwiYWNjb3VudHMiLCJsb2FucyIsInRvdGFsTG9hbkJhbGFuY2UiLCJjcmVkaXRDYXJkRGVidCIsImNsaWVudERhdGEiLCJlbmNvZGVkS2V5IiwiaWQiLCJhY2NvdW50c1VybCIsInByb2Nlc3MiLCJlbnYiLCJNQU1CVV9CQVNFX1VSTCIsImFjY291bnRzUmVzcG9uc2UiLCJmZXRjaCIsImhlYWRlcnMiLCJNQU1CVV9BUElfS0VZIiwib2siLCJhY2NvdW50c0RhdGEiLCJyYXdBY2NvdW50cyIsIkFycmF5IiwiaXNBcnJheSIsIm1hcCIsImFjYyIsImFjY291bnROdW1iZXIiLCJhY2NvdW50VHlwZSIsInByb2R1Y3RUeXBlS2V5IiwiY3VycmVuY3lDb2RlIiwiYmFsYW5jZSIsInBhcnNlRmxvYXQiLCJhdmFpbGFibGVCYWxhbmNlIiwiYWNjb3VudFN0YXRlIiwic3RhdGUiLCJmb3JFYWNoIiwibG9hbnNVcmwiLCJsb2Fuc1Jlc3BvbnNlIiwibG9hbnNEYXRhIiwibG9hbiIsInByaW5jaXBhbEJhbGFuY2UiLCJjb25zb2xlIiwid2FybiIsImNyZWRpdENhcmRzVXJsIiwiY3JlZGl0Q2FyZHNSZXNwb25zZSIsImNyZWRpdENhcmRzRGF0YSIsImNyZWRpdENhcmRMb2FucyIsImNhcmQiLCJhdmFpbGFibGVDcmVkaXQiLCJtZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/mambu/account/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/mambu.ts":
/*!**********************!*\
  !*** ./lib/mambu.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authenticateMambuUser: () => (/* binding */ authenticateMambuUser),\n/* harmony export */   closeMambuAccount: () => (/* binding */ closeMambuAccount),\n/* harmony export */   closeMambuClient: () => (/* binding */ closeMambuClient),\n/* harmony export */   createMambuClient: () => (/* binding */ createMambuClient),\n/* harmony export */   createMambuDeposit: () => (/* binding */ createMambuDeposit),\n/* harmony export */   createMambuDepositByEmail: () => (/* binding */ createMambuDepositByEmail),\n/* harmony export */   createMambuTransfer: () => (/* binding */ createMambuTransfer),\n/* harmony export */   createMambuUser: () => (/* binding */ createMambuUser),\n/* harmony export */   createMambuWithdrawal: () => (/* binding */ createMambuWithdrawal),\n/* harmony export */   findClientByEmail: () => (/* binding */ findClientByEmail),\n/* harmony export */   findUserByEmail: () => (/* binding */ findUserByEmail),\n/* harmony export */   getMambuKYCStatus: () => (/* binding */ getMambuKYCStatus),\n/* harmony export */   getMambuKYCStatusByEmail: () => (/* binding */ getMambuKYCStatusByEmail),\n/* harmony export */   isMambuConfigured: () => (/* binding */ isMambuConfigured),\n/* harmony export */   requestPasswordReset: () => (/* binding */ requestPasswordReset),\n/* harmony export */   resetPasswordWithToken: () => (/* binding */ resetPasswordWithToken),\n/* harmony export */   updateUserPassword: () => (/* binding */ updateUserPassword),\n/* harmony export */   uploadMambuKYCDocument: () => (/* binding */ uploadMambuKYCDocument)\n/* harmony export */ });\n/**\n * Mambu API Client\n * Mambu API ile iletişim için yardımcı fonksiyonlar\n */ const MAMBU_BASE_URL = process.env.MAMBU_BASE_URL || \"\";\nconst MAMBU_API_KEY = process.env.MAMBU_API_KEY || \"\";\nconst MAMBU_TENANT_ID = process.env.MAMBU_TENANT_ID || \"\";\n/**\n * Mambu API'ye istek gönderir\n */ async function mambuRequest(endpoint, method = \"GET\", body, headers) {\n    const url = `${MAMBU_BASE_URL}/api/${endpoint}`;\n    const defaultHeaders = {\n        \"Content-Type\": \"application/json\",\n        \"Accept\": \"application/vnd.mambu.v2+json\",\n        \"apiKey\": MAMBU_API_KEY,\n        ...headers\n    };\n    try {\n        const response = await fetch(url, {\n            method,\n            headers: defaultHeaders,\n            body: body ? JSON.stringify(body) : undefined\n        });\n        if (!response.ok) {\n            // 404 hatalarını sessizce handle et (client bulunamadığında normal)\n            if (response.status === 404) {\n                return null; // veya boş array döndür\n            }\n            const errorData = await response.json().catch(()=>({\n                    message: response.statusText\n                }));\n            throw new Error(errorData.message || `Mambu API error: ${response.status}`);\n        }\n        return await response.json();\n    } catch (error) {\n        // 404 hatalarını sessizce ignore et\n        if (error.message?.includes(\"404\") || error.message?.includes(\"not found\")) {\n            return null;\n        }\n        console.error(\"Mambu API Error:\", error);\n        throw error;\n    }\n}\n/**\n * Mambu'da yeni client (müşteri) oluşturur\n */ async function createMambuClient(clientData) {\n    const clientPayload = {\n        firstName: clientData.firstName,\n        lastName: clientData.lastName,\n        emailAddress: clientData.email,\n        mobilePhoneNumber: clientData.phoneNumber || \"\",\n        preferredLanguage: clientData.preferredLanguage || \"TR\",\n        ...clientData.birthDate && {\n            birthDate: clientData.birthDate\n        },\n        ...clientData.idDocument && {\n            idDocuments: [\n                clientData.idDocument\n            ]\n        }\n    };\n    return mambuRequest(\"clients\", \"POST\", clientPayload);\n}\n/**\n * Mambu'da kullanıcı oluşturur\n */ async function createMambuUser(userData) {\n    const userPayload = {\n        username: userData.username,\n        email: userData.email,\n        firstName: userData.firstName,\n        lastName: userData.lastName,\n        ...userData.password && {\n            password: userData.password\n        },\n        ...userData.phoneNumber && {\n            phoneNumber: userData.phoneNumber\n        }\n    };\n    return mambuRequest(\"users\", \"POST\", userPayload);\n}\n/**\n * Mambu'da kullanıcı kimlik doğrulaması yapar\n */ async function authenticateMambuUser(username, password) {\n    try {\n        // Mambu OAuth endpoint'i için\n        const url = `${MAMBU_BASE_URL}/api/oauth/token`;\n        const formData = new URLSearchParams();\n        formData.append(\"grant_type\", \"password\");\n        formData.append(\"username\", username);\n        formData.append(\"password\", password);\n        const response = await fetch(url, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/x-www-form-urlencoded\",\n                \"Accept\": \"application/json\",\n                \"apiKey\": MAMBU_API_KEY\n            },\n            body: formData.toString()\n        });\n        if (!response.ok) {\n            const errorData = await response.json().catch(()=>({\n                    error: \"invalid_request\",\n                    error_description: response.statusText\n                }));\n            return errorData;\n        }\n        return await response.json();\n    } catch (error) {\n        console.error(\"Mambu Authentication Error:\", error);\n        return {\n            error: \"server_error\",\n            error_description: error.message || \"Authentication failed\"\n        };\n    }\n}\n/**\n * Mambu'da email ile client arama yapar\n */ async function findClientByEmail(email) {\n    try {\n        const response = await mambuRequest(`clients?email=${encodeURIComponent(email)}`, \"GET\");\n        // 404 durumunda null dönebilir, bunu handle et\n        if (!response) {\n            return null;\n        }\n        return response;\n    } catch (error) {\n        // 404 veya client bulunamadı durumlarını sessizce handle et\n        if (error.message?.includes(\"404\") || error.message?.includes(\"not found\")) {\n            return null;\n        }\n        console.error(\"Find client error:\", error);\n        return null;\n    }\n}\n/**\n * Mambu'da email ile user arama yapar\n */ async function findUserByEmail(email) {\n    try {\n        const response = await mambuRequest(`users?email=${encodeURIComponent(email)}`, \"GET\");\n        return response;\n    } catch (error) {\n        console.error(\"Find user error:\", error);\n        return null;\n    }\n}\n/**\n * Mambu'da şifre sıfırlama isteği gönderir\n */ async function requestPasswordReset(email) {\n    try {\n        // Mambu'da şifre sıfırlama için genellikle email gönderilir\n        // Bu endpoint Mambu yapılandırmasına göre değişebilir\n        const url = `${MAMBU_BASE_URL}/api/users/password-reset`;\n        const response = await fetch(url, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Accept\": \"application/vnd.mambu.v2+json\",\n                \"apiKey\": MAMBU_API_KEY\n            },\n            body: JSON.stringify({\n                email: email\n            })\n        });\n        if (!response.ok) {\n            // 404 veya başka hatalar için de başarılı gibi davran (güvenlik için)\n            // Gerçek kullanıcı olup olmadığını açığa çıkarmamak için\n            return {\n                success: true,\n                message: \"Şifre sıfırlama linki email adresinize g\\xf6nderildi.\"\n            };\n        }\n        return await response.json();\n    } catch (error) {\n        console.error(\"Password reset request error:\", error);\n        // Hata durumunda da başarılı gibi davran (güvenlik için)\n        return {\n            success: true,\n            message: \"Şifre sıfırlama linki email adresinize g\\xf6nderildi.\"\n        };\n    }\n}\n/**\n * Mambu'da şifre sıfırlama token'ı ile şifreyi günceller\n */ async function resetPasswordWithToken(token, newPassword) {\n    try {\n        const url = `${MAMBU_BASE_URL}/api/users/password-reset/confirm`;\n        const response = await fetch(url, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Accept\": \"application/vnd.mambu.v2+json\",\n                \"apiKey\": MAMBU_API_KEY\n            },\n            body: JSON.stringify({\n                token: token,\n                newPassword: newPassword\n            })\n        });\n        if (!response.ok) {\n            const errorData = await response.json().catch(()=>({\n                    message: response.statusText\n                }));\n            throw new Error(errorData.message || `Password reset error: ${response.status}`);\n        }\n        return await response.json();\n    } catch (error) {\n        console.error(\"Password reset confirm error:\", error);\n        throw error;\n    }\n}\n/**\n * Mambu'da kullanıcı şifresini günceller (admin veya authenticated user için)\n */ async function updateUserPassword(userId, newPassword) {\n    try {\n        const url = `${MAMBU_BASE_URL}/api/users/${userId}/password`;\n        const response = await fetch(url, {\n            method: \"PUT\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Accept\": \"application/vnd.mambu.v2+json\",\n                \"apiKey\": MAMBU_API_KEY\n            },\n            body: JSON.stringify({\n                password: newPassword\n            })\n        });\n        if (!response.ok) {\n            const errorData = await response.json().catch(()=>({\n                    message: response.statusText\n                }));\n            throw new Error(errorData.message || `Password update error: ${response.status}`);\n        }\n        return await response.json();\n    } catch (error) {\n        console.error(\"Password update error:\", error);\n        throw error;\n    }\n}\n/**\n * Mambu'da para transferi yapar (deposit account'tan başka bir hesaba)\n */ async function createMambuTransfer(data) {\n    try {\n        // Önce alıcıyı bul (email ile)\n        let toAccountId = data.toAccountId;\n        if (data.toEmail && !toAccountId) {\n            const recipientClient = await findClientByEmail(data.toEmail);\n            if (recipientClient && recipientClient[0]) {\n                const recipientId = recipientClient[0].encodedKey || recipientClient[0].id;\n                // Alıcının deposit account'unu bul\n                const recipientAccountsUrl = `${MAMBU_BASE_URL}/api/deposits?clientId=${recipientId}`;\n                const recipientAccountsResponse = await fetch(recipientAccountsUrl, {\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"Accept\": \"application/vnd.mambu.v2+json\",\n                        \"apiKey\": MAMBU_API_KEY\n                    }\n                });\n                if (recipientAccountsResponse.ok) {\n                    const recipientAccounts = await recipientAccountsResponse.json();\n                    if (Array.isArray(recipientAccounts) && recipientAccounts.length > 0) {\n                        toAccountId = recipientAccounts[0].id || recipientAccounts[0].encodedKey;\n                    }\n                }\n            }\n        }\n        if (!toAccountId) {\n            throw new Error(\"Alıcı hesabı bulunamadı\");\n        }\n        // Transfer işlemi oluştur\n        // Mambu'da transfer için genellikle iki transaction oluşturulur:\n        // 1. Gönderen hesaptan çıkış (withdrawal)\n        // 2. Alıcı hesaba giriş (deposit)\n        const transferPayload = {\n            type: \"TRANSFER\",\n            amount: data.amount,\n            currencyCode: data.currency || \"USD\",\n            notes: data.notes || `Transfer to ${data.toEmail || toAccountId}`,\n            fromAccountId: data.fromAccountId,\n            toAccountId: toAccountId\n        };\n        // Mambu transfer endpoint'i\n        return mambuRequest(\"transfers\", \"POST\", transferPayload);\n    } catch (error) {\n        console.error(\"Mambu transfer error:\", error);\n        throw error;\n    }\n}\n/**\n * Mambu'da deposit işlemi oluşturur (hesaba para yükleme)\n */ async function createMambuDeposit(data) {\n    try {\n        const depositPayload = {\n            type: \"DEPOSIT\",\n            amount: data.amount,\n            currencyCode: data.currency || \"USD\",\n            notes: data.notes || \"Deposit transaction\"\n        };\n        // Mambu deposit transaction endpoint'i\n        return mambuRequest(`deposits/${data.accountId}/transactions`, \"POST\", depositPayload);\n    } catch (error) {\n        console.error(\"Mambu deposit error:\", error);\n        throw error;\n    }\n}\n/**\n * Email ile Mambu hesabına para yükler\n */ async function createMambuDepositByEmail(email, amount, options) {\n    try {\n        // Client'ı bul\n        const client = await findClientByEmail(email);\n        if (!client || !client[0]) {\n            return {\n                success: false,\n                error: \"Kullanıcı bulunamadı\"\n            };\n        }\n        const clientData = client[0];\n        const clientId = clientData.encodedKey || clientData.id;\n        // Deposit account'u bul\n        const accountsUrl = `${MAMBU_BASE_URL}/api/deposits?clientId=${clientId}`;\n        const accountsResponse = await fetch(accountsUrl, {\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Accept\": \"application/vnd.mambu.v2+json\",\n                \"apiKey\": MAMBU_API_KEY\n            }\n        });\n        if (!accountsResponse.ok) {\n            return {\n                success: false,\n                error: \"Hesap bulunamadı\"\n            };\n        }\n        const accounts = await accountsResponse.json();\n        const account = Array.isArray(accounts) && accounts.length > 0 ? accounts[0] : null;\n        if (!account) {\n            return {\n                success: false,\n                error: \"Aktif hesap bulunamadı\"\n            };\n        }\n        const accountId = account.id || account.encodedKey;\n        // Deposit işlemi oluştur\n        const depositResult = await createMambuDeposit({\n            accountId,\n            amount,\n            currency: options?.currency || \"USD\",\n            notes: options?.notes || options?.description || \"Stripe ile para y\\xfckleme\"\n        });\n        return {\n            success: true,\n            depositId: depositResult?.id || depositResult?.encodedKey\n        };\n    } catch (error) {\n        console.error(\"Mambu deposit by email error:\", error);\n        return {\n            success: false,\n            error: error.message || \"Para y\\xfckleme hatası\"\n        };\n    }\n}\n/**\n * Mambu'da withdrawal işlemi oluşturur (hesaptan para çekme)\n */ async function createMambuWithdrawal(data) {\n    try {\n        const withdrawalPayload = {\n            type: \"WITHDRAWAL\",\n            amount: data.amount,\n            currencyCode: data.currency || \"USD\",\n            notes: data.notes || \"Withdrawal transaction\"\n        };\n        // Mambu withdrawal transaction endpoint'i\n        return mambuRequest(`deposits/${data.accountId}/transactions`, \"POST\", withdrawalPayload);\n    } catch (error) {\n        console.error(\"Mambu withdrawal error:\", error);\n        throw error;\n    }\n}\n/**\n * Mambu'da client hesabını kapatır (CLOSED durumuna alır)\n */ async function closeMambuClient(clientId) {\n    try {\n        const closePayload = {\n            state: \"CLOSED\",\n            notes: \"Hesap kullanıcı talebi \\xfczerine kapatıldı\"\n        };\n        return mambuRequest(`clients/${clientId}`, \"PUT\", closePayload);\n    } catch (error) {\n        console.error(\"Mambu close client error:\", error);\n        throw error;\n    }\n}\n/**\n * Mambu'da deposit account'u kapatır\n */ async function closeMambuAccount(accountId) {\n    try {\n        const closePayload = {\n            accountState: \"CLOSED\",\n            notes: \"Hesap kullanıcı talebi \\xfczerine kapatıldı\"\n        };\n        return mambuRequest(`deposits/${accountId}`, \"PUT\", closePayload);\n    } catch (error) {\n        console.error(\"Mambu close account error:\", error);\n        throw error;\n    }\n}\n/**\n * Mambu'da KYC belgeleri yükler (kimlik belgesi, selfie)\n */ async function uploadMambuKYCDocument(clientId, documentType, file, fileName) {\n    try {\n        // Mambu'da belge yükleme için genellikle multipart/form-data kullanılır\n        const formData = new FormData();\n        formData.append(\"file\", file, fileName);\n        formData.append(\"documentType\", documentType);\n        const url = `${MAMBU_BASE_URL}/api/clients/${clientId}/documents`;\n        const response = await fetch(url, {\n            method: \"POST\",\n            headers: {\n                \"Accept\": \"application/vnd.mambu.v2+json\",\n                \"apiKey\": MAMBU_API_KEY\n            },\n            body: formData\n        });\n        if (!response.ok) {\n            const errorData = await response.json().catch(()=>({\n                    message: response.statusText\n                }));\n            throw new Error(errorData.message || `KYC document upload error: ${response.status}`);\n        }\n        return await response.json();\n    } catch (error) {\n        console.error(\"Mambu KYC document upload error:\", error);\n        throw error;\n    }\n}\n/**\n * Mambu'da client'ın KYC durumunu kontrol eder\n */ async function getMambuKYCStatus(clientId) {\n    try {\n        // Mambu'da client'ın belgelerini al\n        const documents = await mambuRequest(`clients/${clientId}/documents`, \"GET\");\n        // KYC durumunu kontrol et\n        // Mambu'da genellikle belgeler yüklendikten sonra manuel veya otomatik doğrulama yapılır\n        // Burada basit bir kontrol yapıyoruz: gerekli belgeler yüklü mü?\n        const requiredDocs = [\n            \"ID_FRONT\",\n            \"ID_BACK\",\n            \"SELFIE\"\n        ];\n        const uploadedDocs = Array.isArray(documents) ? documents.map((doc)=>doc.documentType || doc.type) : [];\n        const hasAllDocs = requiredDocs.every((doc)=>uploadedDocs.some((uploaded)=>uploaded?.toUpperCase().includes(doc) || uploaded?.toUpperCase().includes(\"ID\") || uploaded?.toUpperCase().includes(\"SELFIE\")));\n        // Client'ın durumunu kontrol et\n        const client = await mambuRequest(`clients/${clientId}`, \"GET\");\n        const clientState = client?.state || client?.status || \"ACTIVE\";\n        // KYC doğrulanmış mı? (genellikle client state'i veya özel bir field ile kontrol edilir)\n        // Mambu'da KYC durumu genellikle client'ın state'i veya custom field'ları ile tutulur\n        const isVerified = clientState === \"ACTIVE\" && hasAllDocs;\n        return {\n            verified: isVerified,\n            status: isVerified ? \"VERIFIED\" : hasAllDocs ? \"PENDING\" : \"INCOMPLETE\",\n            documents: Array.isArray(documents) ? documents : []\n        };\n    } catch (error) {\n        console.error(\"Mambu KYC status error:\", error);\n        // Hata durumunda doğrulanmamış olarak döndür\n        return {\n            verified: false,\n            status: \"UNKNOWN\",\n            documents: []\n        };\n    }\n}\n/**\n * Mambu'da email ile client'ın KYC durumunu kontrol eder\n */ async function getMambuKYCStatusByEmail(email) {\n    try {\n        const client = await findClientByEmail(email);\n        if (!client || !client[0]) {\n            return {\n                verified: false,\n                status: \"CLIENT_NOT_FOUND\",\n                documents: []\n            };\n        }\n        const clientId = client[0].encodedKey || client[0].id;\n        const kycStatus = await getMambuKYCStatus(clientId);\n        return {\n            ...kycStatus,\n            clientId\n        };\n    } catch (error) {\n        console.error(\"Mambu KYC status by email error:\", error);\n        return {\n            verified: false,\n            status: \"UNKNOWN\",\n            documents: []\n        };\n    }\n}\n/**\n * Mambu API yapılandırmasını kontrol eder\n */ function isMambuConfigured() {\n    return !!(MAMBU_BASE_URL && MAMBU_API_KEY);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V0FBVyxFQUFFO1FBQ2Y7SUFDRjtBQUNGO0FBRUE7O0NBRUMsR0FDTSxTQUFTZTtJQUNkLE9BQU8sQ0FBQyxDQUFFN0gsQ0FBQUEsa0JBQWtCRyxhQUFZO0FBQzFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZGF0cGF5Ly4vbGliL21hbWJ1LnRzPzMzZDIiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNYW1idSBBUEkgQ2xpZW50XG4gKiBNYW1idSBBUEkgaWxlIGlsZXRpxZ9pbSBpw6dpbiB5YXJkxLFtY8SxIGZvbmtzaXlvbmxhclxuICovXG5cbmNvbnN0IE1BTUJVX0JBU0VfVVJMID0gcHJvY2Vzcy5lbnYuTUFNQlVfQkFTRV9VUkwgfHwgJyc7XG5jb25zdCBNQU1CVV9BUElfS0VZID0gcHJvY2Vzcy5lbnYuTUFNQlVfQVBJX0tFWSB8fCAnJztcbmNvbnN0IE1BTUJVX1RFTkFOVF9JRCA9IHByb2Nlc3MuZW52Lk1BTUJVX1RFTkFOVF9JRCB8fCAnJztcblxuaW50ZXJmYWNlIE1hbWJ1Q2xpZW50IHtcbiAgZmlyc3ROYW1lOiBzdHJpbmc7XG4gIGxhc3ROYW1lOiBzdHJpbmc7XG4gIGVtYWlsOiBzdHJpbmc7XG4gIHBob25lTnVtYmVyPzogc3RyaW5nO1xuICBwcmVmZXJyZWRMYW5ndWFnZT86IHN0cmluZztcbiAgYmlydGhEYXRlPzogc3RyaW5nO1xuICBpZERvY3VtZW50Pzoge1xuICAgIGRvY3VtZW50VHlwZT86IHN0cmluZztcbiAgICBkb2N1bWVudElkPzogc3RyaW5nO1xuICB9O1xufVxuXG5pbnRlcmZhY2UgTWFtYnVVc2VyIHtcbiAgdXNlcm5hbWU6IHN0cmluZztcbiAgZW1haWw6IHN0cmluZztcbiAgZmlyc3ROYW1lOiBzdHJpbmc7XG4gIGxhc3ROYW1lOiBzdHJpbmc7XG4gIHBhc3N3b3JkPzogc3RyaW5nO1xuICBwaG9uZU51bWJlcj86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIE1hbWJ1QXV0aFJlc3BvbnNlIHtcbiAgYWNjZXNzX3Rva2VuPzogc3RyaW5nO1xuICB0b2tlbl90eXBlPzogc3RyaW5nO1xuICBleHBpcmVzX2luPzogbnVtYmVyO1xuICBlcnJvcj86IHN0cmluZztcbiAgZXJyb3JfZGVzY3JpcHRpb24/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogTWFtYnUgQVBJJ3llIGlzdGVrIGfDtm5kZXJpclxuICovXG5hc3luYyBmdW5jdGlvbiBtYW1idVJlcXVlc3QoXG4gIGVuZHBvaW50OiBzdHJpbmcsXG4gIG1ldGhvZDogJ0dFVCcgfCAnUE9TVCcgfCAnUFVUJyB8ICdERUxFVEUnID0gJ0dFVCcsXG4gIGJvZHk/OiBhbnksXG4gIGhlYWRlcnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+XG4pOiBQcm9taXNlPGFueT4ge1xuICBjb25zdCB1cmwgPSBgJHtNQU1CVV9CQVNFX1VSTH0vYXBpLyR7ZW5kcG9pbnR9YDtcbiAgXG4gIGNvbnN0IGRlZmF1bHRIZWFkZXJzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi92bmQubWFtYnUudjIranNvbicsXG4gICAgJ2FwaUtleSc6IE1BTUJVX0FQSV9LRVksXG4gICAgLi4uaGVhZGVycyxcbiAgfTtcblxuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7XG4gICAgICBtZXRob2QsXG4gICAgICBoZWFkZXJzOiBkZWZhdWx0SGVhZGVycyxcbiAgICAgIGJvZHk6IGJvZHkgPyBKU09OLnN0cmluZ2lmeShib2R5KSA6IHVuZGVmaW5lZCxcbiAgICB9KTtcblxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIC8vIDQwNCBoYXRhbGFyxLFuxLEgc2Vzc2l6Y2UgaGFuZGxlIGV0IChjbGllbnQgYnVsdW5hbWFkxLHEn8SxbmRhIG5vcm1hbClcbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwNCkge1xuICAgICAgICByZXR1cm4gbnVsbDsgLy8gdmV5YSBib8WfIGFycmF5IGTDtm5kw7xyXG4gICAgICB9XG4gICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCkuY2F0Y2goKCkgPT4gKHsgbWVzc2FnZTogcmVzcG9uc2Uuc3RhdHVzVGV4dCB9KSk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JEYXRhLm1lc3NhZ2UgfHwgYE1hbWJ1IEFQSSBlcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIC8vIDQwNCBoYXRhbGFyxLFuxLEgc2Vzc2l6Y2UgaWdub3JlIGV0XG4gICAgaWYgKGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCc0MDQnKSB8fCBlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnbm90IGZvdW5kJykpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zb2xlLmVycm9yKCdNYW1idSBBUEkgRXJyb3I6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogTWFtYnUnZGEgeWVuaSBjbGllbnQgKG3DvMWfdGVyaSkgb2x1xZ90dXJ1clxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlTWFtYnVDbGllbnQoY2xpZW50RGF0YTogTWFtYnVDbGllbnQpOiBQcm9taXNlPGFueT4ge1xuICBjb25zdCBjbGllbnRQYXlsb2FkID0ge1xuICAgIGZpcnN0TmFtZTogY2xpZW50RGF0YS5maXJzdE5hbWUsXG4gICAgbGFzdE5hbWU6IGNsaWVudERhdGEubGFzdE5hbWUsXG4gICAgZW1haWxBZGRyZXNzOiBjbGllbnREYXRhLmVtYWlsLFxuICAgIG1vYmlsZVBob25lTnVtYmVyOiBjbGllbnREYXRhLnBob25lTnVtYmVyIHx8ICcnLFxuICAgIHByZWZlcnJlZExhbmd1YWdlOiBjbGllbnREYXRhLnByZWZlcnJlZExhbmd1YWdlIHx8ICdUUicsXG4gICAgLi4uKGNsaWVudERhdGEuYmlydGhEYXRlICYmIHsgYmlydGhEYXRlOiBjbGllbnREYXRhLmJpcnRoRGF0ZSB9KSxcbiAgICAuLi4oY2xpZW50RGF0YS5pZERvY3VtZW50ICYmIHsgaWREb2N1bWVudHM6IFtjbGllbnREYXRhLmlkRG9jdW1lbnRdIH0pLFxuICB9O1xuXG4gIHJldHVybiBtYW1idVJlcXVlc3QoJ2NsaWVudHMnLCAnUE9TVCcsIGNsaWVudFBheWxvYWQpO1xufVxuXG4vKipcbiAqIE1hbWJ1J2RhIGt1bGxhbsSxY8SxIG9sdcWfdHVydXJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZU1hbWJ1VXNlcih1c2VyRGF0YTogTWFtYnVVc2VyKTogUHJvbWlzZTxhbnk+IHtcbiAgY29uc3QgdXNlclBheWxvYWQgPSB7XG4gICAgdXNlcm5hbWU6IHVzZXJEYXRhLnVzZXJuYW1lLFxuICAgIGVtYWlsOiB1c2VyRGF0YS5lbWFpbCxcbiAgICBmaXJzdE5hbWU6IHVzZXJEYXRhLmZpcnN0TmFtZSxcbiAgICBsYXN0TmFtZTogdXNlckRhdGEubGFzdE5hbWUsXG4gICAgLi4uKHVzZXJEYXRhLnBhc3N3b3JkICYmIHsgcGFzc3dvcmQ6IHVzZXJEYXRhLnBhc3N3b3JkIH0pLFxuICAgIC4uLih1c2VyRGF0YS5waG9uZU51bWJlciAmJiB7IHBob25lTnVtYmVyOiB1c2VyRGF0YS5waG9uZU51bWJlciB9KSxcbiAgfTtcblxuICByZXR1cm4gbWFtYnVSZXF1ZXN0KCd1c2VycycsICdQT1NUJywgdXNlclBheWxvYWQpO1xufVxuXG4vKipcbiAqIE1hbWJ1J2RhIGt1bGxhbsSxY8SxIGtpbWxpayBkb8SfcnVsYW1hc8SxIHlhcGFyXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhdXRoZW50aWNhdGVNYW1idVVzZXIoXG4gIHVzZXJuYW1lOiBzdHJpbmcsXG4gIHBhc3N3b3JkOiBzdHJpbmdcbik6IFByb21pc2U8TWFtYnVBdXRoUmVzcG9uc2U+IHtcbiAgdHJ5IHtcbiAgICAvLyBNYW1idSBPQXV0aCBlbmRwb2ludCdpIGnDp2luXG4gICAgY29uc3QgdXJsID0gYCR7TUFNQlVfQkFTRV9VUkx9L2FwaS9vYXV0aC90b2tlbmA7XG4gICAgXG4gICAgY29uc3QgZm9ybURhdGEgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7XG4gICAgZm9ybURhdGEuYXBwZW5kKCdncmFudF90eXBlJywgJ3Bhc3N3b3JkJyk7XG4gICAgZm9ybURhdGEuYXBwZW5kKCd1c2VybmFtZScsIHVzZXJuYW1lKTtcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ3Bhc3N3b3JkJywgcGFzc3dvcmQpO1xuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsXG4gICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICdhcGlLZXknOiBNQU1CVV9BUElfS0VZLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IGZvcm1EYXRhLnRvU3RyaW5nKCksXG4gICAgfSk7XG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCkuY2F0Y2goKCkgPT4gKHsgXG4gICAgICAgIGVycm9yOiAnaW52YWxpZF9yZXF1ZXN0JyxcbiAgICAgICAgZXJyb3JfZGVzY3JpcHRpb246IHJlc3BvbnNlLnN0YXR1c1RleHQgXG4gICAgICB9KSk7XG4gICAgICByZXR1cm4gZXJyb3JEYXRhO1xuICAgIH1cblxuICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdNYW1idSBBdXRoZW50aWNhdGlvbiBFcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIGVycm9yOiAnc2VydmVyX2Vycm9yJyxcbiAgICAgIGVycm9yX2Rlc2NyaXB0aW9uOiBlcnJvci5tZXNzYWdlIHx8ICdBdXRoZW50aWNhdGlvbiBmYWlsZWQnLFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBNYW1idSdkYSBlbWFpbCBpbGUgY2xpZW50IGFyYW1hIHlhcGFyXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaW5kQ2xpZW50QnlFbWFpbChlbWFpbDogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG1hbWJ1UmVxdWVzdChgY2xpZW50cz9lbWFpbD0ke2VuY29kZVVSSUNvbXBvbmVudChlbWFpbCl9YCwgJ0dFVCcpO1xuICAgIC8vIDQwNCBkdXJ1bXVuZGEgbnVsbCBkw7ZuZWJpbGlyLCBidW51IGhhbmRsZSBldFxuICAgIGlmICghcmVzcG9uc2UpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAvLyA0MDQgdmV5YSBjbGllbnQgYnVsdW5hbWFkxLEgZHVydW1sYXLEsW7EsSBzZXNzaXpjZSBoYW5kbGUgZXRcbiAgICBpZiAoZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJzQwNCcpIHx8IGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdub3QgZm91bmQnKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnNvbGUuZXJyb3IoJ0ZpbmQgY2xpZW50IGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqIE1hbWJ1J2RhIGVtYWlsIGlsZSB1c2VyIGFyYW1hIHlhcGFyXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaW5kVXNlckJ5RW1haWwoZW1haWw6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBtYW1idVJlcXVlc3QoYHVzZXJzP2VtYWlsPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGVtYWlsKX1gLCAnR0VUJyk7XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0ZpbmQgdXNlciBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLyoqXG4gKiBNYW1idSdkYSDFn2lmcmUgc8SxZsSxcmxhbWEgaXN0ZcSfaSBnw7ZuZGVyaXJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlcXVlc3RQYXNzd29yZFJlc2V0KGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICB0cnkge1xuICAgIC8vIE1hbWJ1J2RhIMWfaWZyZSBzxLFmxLFybGFtYSBpw6dpbiBnZW5lbGxpa2xlIGVtYWlsIGfDtm5kZXJpbGlyXG4gICAgLy8gQnUgZW5kcG9pbnQgTWFtYnUgeWFwxLFsYW5kxLFybWFzxLFuYSBnw7ZyZSBkZcSfacWfZWJpbGlyXG4gICAgY29uc3QgdXJsID0gYCR7TUFNQlVfQkFTRV9VUkx9L2FwaS91c2Vycy9wYXNzd29yZC1yZXNldGA7XG4gICAgXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL3ZuZC5tYW1idS52Mitqc29uJyxcbiAgICAgICAgJ2FwaUtleSc6IE1BTUJVX0FQSV9LRVksXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICB9KSxcbiAgICB9KTtcblxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIC8vIDQwNCB2ZXlhIGJhxZ9rYSBoYXRhbGFyIGnDp2luIGRlIGJhxZ9hcsSxbMSxIGdpYmkgZGF2cmFuIChnw7x2ZW5saWsgacOnaW4pXG4gICAgICAvLyBHZXLDp2VrIGt1bGxhbsSxY8SxIG9sdXAgb2xtYWTEscSfxLFuxLEgYcOnxLHEn2Egw6fEsWthcm1hbWFrIGnDp2luXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnxZ5pZnJlIHPEsWbEsXJsYW1hIGxpbmtpIGVtYWlsIGFkcmVzaW5pemUgZ8O2bmRlcmlsZGkuJyB9O1xuICAgIH1cblxuICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdQYXNzd29yZCByZXNldCByZXF1ZXN0IGVycm9yOicsIGVycm9yKTtcbiAgICAvLyBIYXRhIGR1cnVtdW5kYSBkYSBiYcWfYXLEsWzEsSBnaWJpIGRhdnJhbiAoZ8O8dmVubGlrIGnDp2luKVxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6ICfFnmlmcmUgc8SxZsSxcmxhbWEgbGlua2kgZW1haWwgYWRyZXNpbml6ZSBnw7ZuZGVyaWxkaS4nIH07XG4gIH1cbn1cblxuLyoqXG4gKiBNYW1idSdkYSDFn2lmcmUgc8SxZsSxcmxhbWEgdG9rZW4nxLEgaWxlIMWfaWZyZXlpIGfDvG5jZWxsZXJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlc2V0UGFzc3dvcmRXaXRoVG9rZW4odG9rZW46IHN0cmluZywgbmV3UGFzc3dvcmQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXJsID0gYCR7TUFNQlVfQkFTRV9VUkx9L2FwaS91c2Vycy9wYXNzd29yZC1yZXNldC9jb25maXJtYDtcbiAgICBcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vdm5kLm1hbWJ1LnYyK2pzb24nLFxuICAgICAgICAnYXBpS2V5JzogTUFNQlVfQVBJX0tFWSxcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHRva2VuOiB0b2tlbixcbiAgICAgICAgbmV3UGFzc3dvcmQ6IG5ld1Bhc3N3b3JkLFxuICAgICAgfSksXG4gICAgfSk7XG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCkuY2F0Y2goKCkgPT4gKHsgbWVzc2FnZTogcmVzcG9uc2Uuc3RhdHVzVGV4dCB9KSk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JEYXRhLm1lc3NhZ2UgfHwgYFBhc3N3b3JkIHJlc2V0IGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignUGFzc3dvcmQgcmVzZXQgY29uZmlybSBlcnJvcjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuLyoqXG4gKiBNYW1idSdkYSBrdWxsYW7EsWPEsSDFn2lmcmVzaW5pIGfDvG5jZWxsZXIgKGFkbWluIHZleWEgYXV0aGVudGljYXRlZCB1c2VyIGnDp2luKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlVXNlclBhc3N3b3JkKHVzZXJJZDogc3RyaW5nLCBuZXdQYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1cmwgPSBgJHtNQU1CVV9CQVNFX1VSTH0vYXBpL3VzZXJzLyR7dXNlcklkfS9wYXNzd29yZGA7XG4gICAgXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vdm5kLm1hbWJ1LnYyK2pzb24nLFxuICAgICAgICAnYXBpS2V5JzogTUFNQlVfQVBJX0tFWSxcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHBhc3N3b3JkOiBuZXdQYXNzd29yZCxcbiAgICAgIH0pLFxuICAgIH0pO1xuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgY29uc3QgZXJyb3JEYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpLmNhdGNoKCgpID0+ICh7IG1lc3NhZ2U6IHJlc3BvbnNlLnN0YXR1c1RleHQgfSkpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yRGF0YS5tZXNzYWdlIHx8IGBQYXNzd29yZCB1cGRhdGUgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xuICAgIH1cblxuICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdQYXNzd29yZCB1cGRhdGUgZXJyb3I6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogTWFtYnUnZGEgcGFyYSB0cmFuc2ZlcmkgeWFwYXIgKGRlcG9zaXQgYWNjb3VudCd0YW4gYmHFn2thIGJpciBoZXNhYmEpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVNYW1idVRyYW5zZmVyKGRhdGE6IHtcbiAgZnJvbUFjY291bnRJZDogc3RyaW5nO1xuICB0b0FjY291bnRJZD86IHN0cmluZztcbiAgdG9FbWFpbD86IHN0cmluZztcbiAgYW1vdW50OiBudW1iZXI7XG4gIGN1cnJlbmN5Pzogc3RyaW5nO1xuICBub3Rlcz86IHN0cmluZztcbn0pOiBQcm9taXNlPGFueT4ge1xuICB0cnkge1xuICAgIC8vIMOWbmNlIGFsxLFjxLF5xLEgYnVsIChlbWFpbCBpbGUpXG4gICAgbGV0IHRvQWNjb3VudElkID0gZGF0YS50b0FjY291bnRJZDtcbiAgICBcbiAgICBpZiAoZGF0YS50b0VtYWlsICYmICF0b0FjY291bnRJZCkge1xuICAgICAgY29uc3QgcmVjaXBpZW50Q2xpZW50ID0gYXdhaXQgZmluZENsaWVudEJ5RW1haWwoZGF0YS50b0VtYWlsKTtcbiAgICAgIGlmIChyZWNpcGllbnRDbGllbnQgJiYgcmVjaXBpZW50Q2xpZW50WzBdKSB7XG4gICAgICAgIGNvbnN0IHJlY2lwaWVudElkID0gcmVjaXBpZW50Q2xpZW50WzBdLmVuY29kZWRLZXkgfHwgcmVjaXBpZW50Q2xpZW50WzBdLmlkO1xuICAgICAgICBcbiAgICAgICAgLy8gQWzEsWPEsW7EsW4gZGVwb3NpdCBhY2NvdW50J3VudSBidWxcbiAgICAgICAgY29uc3QgcmVjaXBpZW50QWNjb3VudHNVcmwgPSBgJHtNQU1CVV9CQVNFX1VSTH0vYXBpL2RlcG9zaXRzP2NsaWVudElkPSR7cmVjaXBpZW50SWR9YDtcbiAgICAgICAgY29uc3QgcmVjaXBpZW50QWNjb3VudHNSZXNwb25zZSA9IGF3YWl0IGZldGNoKHJlY2lwaWVudEFjY291bnRzVXJsLCB7XG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vdm5kLm1hbWJ1LnYyK2pzb24nLFxuICAgICAgICAgICAgJ2FwaUtleSc6IE1BTUJVX0FQSV9LRVksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVjaXBpZW50QWNjb3VudHNSZXNwb25zZS5vaykge1xuICAgICAgICAgIGNvbnN0IHJlY2lwaWVudEFjY291bnRzID0gYXdhaXQgcmVjaXBpZW50QWNjb3VudHNSZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVjaXBpZW50QWNjb3VudHMpICYmIHJlY2lwaWVudEFjY291bnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRvQWNjb3VudElkID0gcmVjaXBpZW50QWNjb3VudHNbMF0uaWQgfHwgcmVjaXBpZW50QWNjb3VudHNbMF0uZW5jb2RlZEtleTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgaWYgKCF0b0FjY291bnRJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBbMSxY8SxIGhlc2FixLEgYnVsdW5hbWFkxLEnKTtcbiAgICB9XG4gICAgXG4gICAgLy8gVHJhbnNmZXIgacWfbGVtaSBvbHXFn3R1clxuICAgIC8vIE1hbWJ1J2RhIHRyYW5zZmVyIGnDp2luIGdlbmVsbGlrbGUgaWtpIHRyYW5zYWN0aW9uIG9sdcWfdHVydWx1cjpcbiAgICAvLyAxLiBHw7ZuZGVyZW4gaGVzYXB0YW4gw6fEsWvEscWfICh3aXRoZHJhd2FsKVxuICAgIC8vIDIuIEFsxLFjxLEgaGVzYWJhIGdpcmnFnyAoZGVwb3NpdClcbiAgICBcbiAgICBjb25zdCB0cmFuc2ZlclBheWxvYWQgPSB7XG4gICAgICB0eXBlOiAnVFJBTlNGRVInLFxuICAgICAgYW1vdW50OiBkYXRhLmFtb3VudCxcbiAgICAgIGN1cnJlbmN5Q29kZTogZGF0YS5jdXJyZW5jeSB8fCAnVVNEJyxcbiAgICAgIG5vdGVzOiBkYXRhLm5vdGVzIHx8IGBUcmFuc2ZlciB0byAke2RhdGEudG9FbWFpbCB8fCB0b0FjY291bnRJZH1gLFxuICAgICAgZnJvbUFjY291bnRJZDogZGF0YS5mcm9tQWNjb3VudElkLFxuICAgICAgdG9BY2NvdW50SWQ6IHRvQWNjb3VudElkLFxuICAgIH07XG4gICAgXG4gICAgLy8gTWFtYnUgdHJhbnNmZXIgZW5kcG9pbnQnaVxuICAgIHJldHVybiBtYW1idVJlcXVlc3QoJ3RyYW5zZmVycycsICdQT1NUJywgdHJhbnNmZXJQYXlsb2FkKTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ01hbWJ1IHRyYW5zZmVyIGVycm9yOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vKipcbiAqIE1hbWJ1J2RhIGRlcG9zaXQgacWfbGVtaSBvbHXFn3R1cnVyIChoZXNhYmEgcGFyYSB5w7xrbGVtZSlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZU1hbWJ1RGVwb3NpdChkYXRhOiB7XG4gIGFjY291bnRJZDogc3RyaW5nO1xuICBhbW91bnQ6IG51bWJlcjtcbiAgY3VycmVuY3k/OiBzdHJpbmc7XG4gIG5vdGVzPzogc3RyaW5nO1xufSk6IFByb21pc2U8YW55PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZGVwb3NpdFBheWxvYWQgPSB7XG4gICAgICB0eXBlOiAnREVQT1NJVCcsXG4gICAgICBhbW91bnQ6IGRhdGEuYW1vdW50LFxuICAgICAgY3VycmVuY3lDb2RlOiBkYXRhLmN1cnJlbmN5IHx8ICdVU0QnLFxuICAgICAgbm90ZXM6IGRhdGEubm90ZXMgfHwgJ0RlcG9zaXQgdHJhbnNhY3Rpb24nLFxuICAgIH07XG4gICAgXG4gICAgLy8gTWFtYnUgZGVwb3NpdCB0cmFuc2FjdGlvbiBlbmRwb2ludCdpXG4gICAgcmV0dXJuIG1hbWJ1UmVxdWVzdChgZGVwb3NpdHMvJHtkYXRhLmFjY291bnRJZH0vdHJhbnNhY3Rpb25zYCwgJ1BPU1QnLCBkZXBvc2l0UGF5bG9hZCk7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdNYW1idSBkZXBvc2l0IGVycm9yOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vKipcbiAqIEVtYWlsIGlsZSBNYW1idSBoZXNhYsSxbmEgcGFyYSB5w7xrbGVyXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVNYW1idURlcG9zaXRCeUVtYWlsKFxuICBlbWFpbDogc3RyaW5nLFxuICBhbW91bnQ6IG51bWJlcixcbiAgb3B0aW9ucz86IHtcbiAgICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgICBub3Rlcz86IHN0cmluZztcbiAgICBjdXJyZW5jeT86IHN0cmluZztcbiAgfVxuKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IGRlcG9zaXRJZD86IHN0cmluZzsgZXJyb3I/OiBzdHJpbmcgfT4ge1xuICB0cnkge1xuICAgIC8vIENsaWVudCfEsSBidWxcbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBmaW5kQ2xpZW50QnlFbWFpbChlbWFpbCk7XG4gICAgaWYgKCFjbGllbnQgfHwgIWNsaWVudFswXSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnS3VsbGFuxLFjxLEgYnVsdW5hbWFkxLEnLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBjbGllbnREYXRhID0gY2xpZW50WzBdO1xuICAgIGNvbnN0IGNsaWVudElkID0gY2xpZW50RGF0YS5lbmNvZGVkS2V5IHx8IGNsaWVudERhdGEuaWQ7XG5cbiAgICAvLyBEZXBvc2l0IGFjY291bnQndSBidWxcbiAgICBjb25zdCBhY2NvdW50c1VybCA9IGAke01BTUJVX0JBU0VfVVJMfS9hcGkvZGVwb3NpdHM/Y2xpZW50SWQ9JHtjbGllbnRJZH1gO1xuICAgIGNvbnN0IGFjY291bnRzUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChhY2NvdW50c1VybCwge1xuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL3ZuZC5tYW1idS52Mitqc29uJyxcbiAgICAgICAgJ2FwaUtleSc6IE1BTUJVX0FQSV9LRVksXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFhY2NvdW50c1Jlc3BvbnNlLm9rKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdIZXNhcCBidWx1bmFtYWTEsScsXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IGFjY291bnRzID0gYXdhaXQgYWNjb3VudHNSZXNwb25zZS5qc29uKCk7XG4gICAgY29uc3QgYWNjb3VudCA9IEFycmF5LmlzQXJyYXkoYWNjb3VudHMpICYmIGFjY291bnRzLmxlbmd0aCA+IDAgPyBhY2NvdW50c1swXSA6IG51bGw7XG5cbiAgICBpZiAoIWFjY291bnQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ0FrdGlmIGhlc2FwIGJ1bHVuYW1hZMSxJyxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgYWNjb3VudElkID0gYWNjb3VudC5pZCB8fCBhY2NvdW50LmVuY29kZWRLZXk7XG5cbiAgICAvLyBEZXBvc2l0IGnFn2xlbWkgb2x1xZ90dXJcbiAgICBjb25zdCBkZXBvc2l0UmVzdWx0ID0gYXdhaXQgY3JlYXRlTWFtYnVEZXBvc2l0KHtcbiAgICAgIGFjY291bnRJZCxcbiAgICAgIGFtb3VudCxcbiAgICAgIGN1cnJlbmN5OiBvcHRpb25zPy5jdXJyZW5jeSB8fCAnVVNEJyxcbiAgICAgIG5vdGVzOiBvcHRpb25zPy5ub3RlcyB8fCBvcHRpb25zPy5kZXNjcmlwdGlvbiB8fCAnU3RyaXBlIGlsZSBwYXJhIHnDvGtsZW1lJyxcbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGVwb3NpdElkOiBkZXBvc2l0UmVzdWx0Py5pZCB8fCBkZXBvc2l0UmVzdWx0Py5lbmNvZGVkS2V5LFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdNYW1idSBkZXBvc2l0IGJ5IGVtYWlsIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSB8fCAnUGFyYSB5w7xrbGVtZSBoYXRhc8SxJyxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogTWFtYnUnZGEgd2l0aGRyYXdhbCBpxZ9sZW1pIG9sdcWfdHVydXIgKGhlc2FwdGFuIHBhcmEgw6dla21lKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlTWFtYnVXaXRoZHJhd2FsKGRhdGE6IHtcbiAgYWNjb3VudElkOiBzdHJpbmc7XG4gIGFtb3VudDogbnVtYmVyO1xuICBjdXJyZW5jeT86IHN0cmluZztcbiAgbm90ZXM/OiBzdHJpbmc7XG59KTogUHJvbWlzZTxhbnk+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB3aXRoZHJhd2FsUGF5bG9hZCA9IHtcbiAgICAgIHR5cGU6ICdXSVRIRFJBV0FMJyxcbiAgICAgIGFtb3VudDogZGF0YS5hbW91bnQsXG4gICAgICBjdXJyZW5jeUNvZGU6IGRhdGEuY3VycmVuY3kgfHwgJ1VTRCcsXG4gICAgICBub3RlczogZGF0YS5ub3RlcyB8fCAnV2l0aGRyYXdhbCB0cmFuc2FjdGlvbicsXG4gICAgfTtcbiAgICBcbiAgICAvLyBNYW1idSB3aXRoZHJhd2FsIHRyYW5zYWN0aW9uIGVuZHBvaW50J2lcbiAgICByZXR1cm4gbWFtYnVSZXF1ZXN0KGBkZXBvc2l0cy8ke2RhdGEuYWNjb3VudElkfS90cmFuc2FjdGlvbnNgLCAnUE9TVCcsIHdpdGhkcmF3YWxQYXlsb2FkKTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ01hbWJ1IHdpdGhkcmF3YWwgZXJyb3I6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogTWFtYnUnZGEgY2xpZW50IGhlc2FixLFuxLEga2FwYXTEsXIgKENMT1NFRCBkdXJ1bXVuYSBhbMSxcilcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsb3NlTWFtYnVDbGllbnQoY2xpZW50SWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY2xvc2VQYXlsb2FkID0ge1xuICAgICAgc3RhdGU6ICdDTE9TRUQnLFxuICAgICAgbm90ZXM6ICdIZXNhcCBrdWxsYW7EsWPEsSB0YWxlYmkgw7x6ZXJpbmUga2FwYXTEsWxkxLEnLFxuICAgIH07XG4gICAgXG4gICAgcmV0dXJuIG1hbWJ1UmVxdWVzdChgY2xpZW50cy8ke2NsaWVudElkfWAsICdQVVQnLCBjbG9zZVBheWxvYWQpO1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignTWFtYnUgY2xvc2UgY2xpZW50IGVycm9yOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vKipcbiAqIE1hbWJ1J2RhIGRlcG9zaXQgYWNjb3VudCd1IGthcGF0xLFyXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbG9zZU1hbWJ1QWNjb3VudChhY2NvdW50SWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY2xvc2VQYXlsb2FkID0ge1xuICAgICAgYWNjb3VudFN0YXRlOiAnQ0xPU0VEJyxcbiAgICAgIG5vdGVzOiAnSGVzYXAga3VsbGFuxLFjxLEgdGFsZWJpIMO8emVyaW5lIGthcGF0xLFsZMSxJyxcbiAgICB9O1xuICAgIFxuICAgIHJldHVybiBtYW1idVJlcXVlc3QoYGRlcG9zaXRzLyR7YWNjb3VudElkfWAsICdQVVQnLCBjbG9zZVBheWxvYWQpO1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignTWFtYnUgY2xvc2UgYWNjb3VudCBlcnJvcjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuLyoqXG4gKiBNYW1idSdkYSBLWUMgYmVsZ2VsZXJpIHnDvGtsZXIgKGtpbWxpayBiZWxnZXNpLCBzZWxmaWUpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGxvYWRNYW1idUtZQ0RvY3VtZW50KFxuICBjbGllbnRJZDogc3RyaW5nLFxuICBkb2N1bWVudFR5cGU6ICdJRF9GUk9OVCcgfCAnSURfQkFDSycgfCAnU0VMRklFJyxcbiAgZmlsZTogRmlsZSB8IEJsb2IsXG4gIGZpbGVOYW1lOiBzdHJpbmdcbik6IFByb21pc2U8YW55PiB7XG4gIHRyeSB7XG4gICAgLy8gTWFtYnUnZGEgYmVsZ2UgecO8a2xlbWUgacOnaW4gZ2VuZWxsaWtsZSBtdWx0aXBhcnQvZm9ybS1kYXRhIGt1bGxhbsSxbMSxclxuICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgZm9ybURhdGEuYXBwZW5kKCdmaWxlJywgZmlsZSwgZmlsZU5hbWUpO1xuICAgIGZvcm1EYXRhLmFwcGVuZCgnZG9jdW1lbnRUeXBlJywgZG9jdW1lbnRUeXBlKTtcbiAgICBcbiAgICBjb25zdCB1cmwgPSBgJHtNQU1CVV9CQVNFX1VSTH0vYXBpL2NsaWVudHMvJHtjbGllbnRJZH0vZG9jdW1lbnRzYDtcbiAgICBcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vdm5kLm1hbWJ1LnYyK2pzb24nLFxuICAgICAgICAnYXBpS2V5JzogTUFNQlVfQVBJX0tFWSxcbiAgICAgICAgLy8gQ29udGVudC1UeXBlIGhlYWRlcifEsW7EsSBla2xlbWUsIGJyb3dzZXIgb3RvbWF0aWsgZWtsZXllY2VrIChtdWx0aXBhcnQvZm9ybS1kYXRhKVxuICAgICAgfSxcbiAgICAgIGJvZHk6IGZvcm1EYXRhLFxuICAgIH0pO1xuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgY29uc3QgZXJyb3JEYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpLmNhdGNoKCgpID0+ICh7IG1lc3NhZ2U6IHJlc3BvbnNlLnN0YXR1c1RleHQgfSkpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yRGF0YS5tZXNzYWdlIHx8IGBLWUMgZG9jdW1lbnQgdXBsb2FkIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignTWFtYnUgS1lDIGRvY3VtZW50IHVwbG9hZCBlcnJvcjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuLyoqXG4gKiBNYW1idSdkYSBjbGllbnQnxLFuIEtZQyBkdXJ1bXVudSBrb250cm9sIGVkZXJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1hbWJ1S1lDU3RhdHVzKGNsaWVudElkOiBzdHJpbmcpOiBQcm9taXNlPHtcbiAgdmVyaWZpZWQ6IGJvb2xlYW47XG4gIHN0YXR1czogc3RyaW5nO1xuICBkb2N1bWVudHM/OiBhbnlbXTtcbn0+IHtcbiAgdHJ5IHtcbiAgICAvLyBNYW1idSdkYSBjbGllbnQnxLFuIGJlbGdlbGVyaW5pIGFsXG4gICAgY29uc3QgZG9jdW1lbnRzID0gYXdhaXQgbWFtYnVSZXF1ZXN0KGBjbGllbnRzLyR7Y2xpZW50SWR9L2RvY3VtZW50c2AsICdHRVQnKTtcbiAgICBcbiAgICAvLyBLWUMgZHVydW11bnUga29udHJvbCBldFxuICAgIC8vIE1hbWJ1J2RhIGdlbmVsbGlrbGUgYmVsZ2VsZXIgecO8a2xlbmRpa3RlbiBzb25yYSBtYW51ZWwgdmV5YSBvdG9tYXRpayBkb8SfcnVsYW1hIHlhcMSxbMSxclxuICAgIC8vIEJ1cmFkYSBiYXNpdCBiaXIga29udHJvbCB5YXDEsXlvcnV6OiBnZXJla2xpIGJlbGdlbGVyIHnDvGtsw7wgbcO8P1xuICAgIGNvbnN0IHJlcXVpcmVkRG9jcyA9IFsnSURfRlJPTlQnLCAnSURfQkFDSycsICdTRUxGSUUnXTtcbiAgICBjb25zdCB1cGxvYWRlZERvY3MgPSBBcnJheS5pc0FycmF5KGRvY3VtZW50cykgXG4gICAgICA/IGRvY3VtZW50cy5tYXAoKGRvYzogYW55KSA9PiBkb2MuZG9jdW1lbnRUeXBlIHx8IGRvYy50eXBlKVxuICAgICAgOiBbXTtcbiAgICBcbiAgICBjb25zdCBoYXNBbGxEb2NzID0gcmVxdWlyZWREb2NzLmV2ZXJ5KGRvYyA9PiBcbiAgICAgIHVwbG9hZGVkRG9jcy5zb21lKCh1cGxvYWRlZDogc3RyaW5nKSA9PiBcbiAgICAgICAgdXBsb2FkZWQ/LnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoZG9jKSB8fCBcbiAgICAgICAgdXBsb2FkZWQ/LnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoJ0lEJykgfHxcbiAgICAgICAgdXBsb2FkZWQ/LnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoJ1NFTEZJRScpXG4gICAgICApXG4gICAgKTtcbiAgICBcbiAgICAvLyBDbGllbnQnxLFuIGR1cnVtdW51IGtvbnRyb2wgZXRcbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBtYW1idVJlcXVlc3QoYGNsaWVudHMvJHtjbGllbnRJZH1gLCAnR0VUJyk7XG4gICAgY29uc3QgY2xpZW50U3RhdGUgPSBjbGllbnQ/LnN0YXRlIHx8IGNsaWVudD8uc3RhdHVzIHx8ICdBQ1RJVkUnO1xuICAgIFxuICAgIC8vIEtZQyBkb8SfcnVsYW5txLHFnyBtxLE/IChnZW5lbGxpa2xlIGNsaWVudCBzdGF0ZSdpIHZleWEgw7Z6ZWwgYmlyIGZpZWxkIGlsZSBrb250cm9sIGVkaWxpcilcbiAgICAvLyBNYW1idSdkYSBLWUMgZHVydW11IGdlbmVsbGlrbGUgY2xpZW50J8SxbiBzdGF0ZSdpIHZleWEgY3VzdG9tIGZpZWxkJ2xhcsSxIGlsZSB0dXR1bHVyXG4gICAgY29uc3QgaXNWZXJpZmllZCA9IGNsaWVudFN0YXRlID09PSAnQUNUSVZFJyAmJiBoYXNBbGxEb2NzO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICB2ZXJpZmllZDogaXNWZXJpZmllZCxcbiAgICAgIHN0YXR1czogaXNWZXJpZmllZCA/ICdWRVJJRklFRCcgOiBoYXNBbGxEb2NzID8gJ1BFTkRJTkcnIDogJ0lOQ09NUExFVEUnLFxuICAgICAgZG9jdW1lbnRzOiBBcnJheS5pc0FycmF5KGRvY3VtZW50cykgPyBkb2N1bWVudHMgOiBbXSxcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcignTWFtYnUgS1lDIHN0YXR1cyBlcnJvcjonLCBlcnJvcik7XG4gICAgLy8gSGF0YSBkdXJ1bXVuZGEgZG/En3J1bGFubWFtxLHFnyBvbGFyYWsgZMO2bmTDvHJcbiAgICByZXR1cm4ge1xuICAgICAgdmVyaWZpZWQ6IGZhbHNlLFxuICAgICAgc3RhdHVzOiAnVU5LTk9XTicsXG4gICAgICBkb2N1bWVudHM6IFtdLFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBNYW1idSdkYSBlbWFpbCBpbGUgY2xpZW50J8SxbiBLWUMgZHVydW11bnUga29udHJvbCBlZGVyXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRNYW1idUtZQ1N0YXR1c0J5RW1haWwoZW1haWw6IHN0cmluZyk6IFByb21pc2U8e1xuICB2ZXJpZmllZDogYm9vbGVhbjtcbiAgc3RhdHVzOiBzdHJpbmc7XG4gIGNsaWVudElkPzogc3RyaW5nO1xuICBkb2N1bWVudHM/OiBhbnlbXTtcbn0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBmaW5kQ2xpZW50QnlFbWFpbChlbWFpbCk7XG4gICAgaWYgKCFjbGllbnQgfHwgIWNsaWVudFswXSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmVyaWZpZWQ6IGZhbHNlLFxuICAgICAgICBzdGF0dXM6ICdDTElFTlRfTk9UX0ZPVU5EJyxcbiAgICAgICAgZG9jdW1lbnRzOiBbXSxcbiAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGNsaWVudElkID0gY2xpZW50WzBdLmVuY29kZWRLZXkgfHwgY2xpZW50WzBdLmlkO1xuICAgIGNvbnN0IGt5Y1N0YXR1cyA9IGF3YWl0IGdldE1hbWJ1S1lDU3RhdHVzKGNsaWVudElkKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgLi4ua3ljU3RhdHVzLFxuICAgICAgY2xpZW50SWQsXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ01hbWJ1IEtZQyBzdGF0dXMgYnkgZW1haWwgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJldHVybiB7XG4gICAgICB2ZXJpZmllZDogZmFsc2UsXG4gICAgICBzdGF0dXM6ICdVTktOT1dOJyxcbiAgICAgIGRvY3VtZW50czogW10sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIE1hbWJ1IEFQSSB5YXDEsWxhbmTEsXJtYXPEsW7EsSBrb250cm9sIGVkZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzTWFtYnVDb25maWd1cmVkKCk6IGJvb2xlYW4ge1xuICByZXR1cm4gISEoTUFNQlVfQkFTRV9VUkwgJiYgTUFNQlVfQVBJX0tFWSk7XG59XG5cbiJdLCJuYW1lcyI6WyJNQU1CVV9CQVNFX1VSTCIsInByb2Nlc3MiLCJlbnYiLCJNQU1CVV9BUElfS0VZIiwiTUFNQlVfVEVOQU5UX0lEIiwibWFtYnVSZXF1ZXN0IiwiZW5kcG9pbnQiLCJtZXRob2QiLCJib2R5IiwiaGVhZGVycyIsInVybCIsImRlZmF1bHRIZWFkZXJzIiwicmVzcG9uc2UiLCJmZXRjaCIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1bmRlZmluZWQiLCJvayIsInN0YXR1cyIsImVycm9yRGF0YSIsImpzb24iLCJjYXRjaCIsIm1lc3NhZ2UiLCJzdGF0dXNUZXh0IiwiRXJyb3IiLCJlcnJvciIsImluY2x1ZGVzIiwiY29uc29sZSIsImNyZWF0ZU1hbWJ1Q2xpZW50IiwiY2xpZW50RGF0YSIsImNsaWVudFBheWxvYWQiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsImVtYWlsQWRkcmVzcyIsImVtYWlsIiwibW9iaWxlUGhvbmVOdW1iZXIiLCJwaG9uZU51bWJlciIsInByZWZlcnJlZExhbmd1YWdlIiwiYmlydGhEYXRlIiwiaWREb2N1bWVudCIsImlkRG9jdW1lbnRzIiwiY3JlYXRlTWFtYnVVc2VyIiwidXNlckRhdGEiLCJ1c2VyUGF5bG9hZCIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJhdXRoZW50aWNhdGVNYW1idVVzZXIiLCJmb3JtRGF0YSIsIlVSTFNlYXJjaFBhcmFtcyIsImFwcGVuZCIsInRvU3RyaW5nIiwiZXJyb3JfZGVzY3JpcHRpb24iLCJmaW5kQ2xpZW50QnlFbWFpbCIsImVuY29kZVVSSUNvbXBvbmVudCIsImZpbmRVc2VyQnlFbWFpbCIsInJlcXVlc3RQYXNzd29yZFJlc2V0Iiwic3VjY2VzcyIsInJlc2V0UGFzc3dvcmRXaXRoVG9rZW4iLCJ0b2tlbiIsIm5ld1Bhc3N3b3JkIiwidXBkYXRlVXNlclBhc3N3b3JkIiwidXNlcklkIiwiY3JlYXRlTWFtYnVUcmFuc2ZlciIsImRhdGEiLCJ0b0FjY291bnRJZCIsInRvRW1haWwiLCJyZWNpcGllbnRDbGllbnQiLCJyZWNpcGllbnRJZCIsImVuY29kZWRLZXkiLCJpZCIsInJlY2lwaWVudEFjY291bnRzVXJsIiwicmVjaXBpZW50QWNjb3VudHNSZXNwb25zZSIsInJlY2lwaWVudEFjY291bnRzIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwidHJhbnNmZXJQYXlsb2FkIiwidHlwZSIsImFtb3VudCIsImN1cnJlbmN5Q29kZSIsImN1cnJlbmN5Iiwibm90ZXMiLCJmcm9tQWNjb3VudElkIiwiY3JlYXRlTWFtYnVEZXBvc2l0IiwiZGVwb3NpdFBheWxvYWQiLCJhY2NvdW50SWQiLCJjcmVhdGVNYW1idURlcG9zaXRCeUVtYWlsIiwib3B0aW9ucyIsImNsaWVudCIsImNsaWVudElkIiwiYWNjb3VudHNVcmwiLCJhY2NvdW50c1Jlc3BvbnNlIiwiYWNjb3VudHMiLCJhY2NvdW50IiwiZGVwb3NpdFJlc3VsdCIsImRlc2NyaXB0aW9uIiwiZGVwb3NpdElkIiwiY3JlYXRlTWFtYnVXaXRoZHJhd2FsIiwid2l0aGRyYXdhbFBheWxvYWQiLCJjbG9zZU1hbWJ1Q2xpZW50IiwiY2xvc2VQYXlsb2FkIiwic3RhdGUiLCJjbG9zZU1hbWJ1QWNjb3VudCIsImFjY291bnRTdGF0ZSIsInVwbG9hZE1hbWJ1S1lDRG9jdW1lbnQiLCJkb2N1bWVudFR5cGUiLCJmaWxlIiwiZmlsZU5hbWUiLCJGb3JtRGF0YSIsImdldE1hbWJ1S1lDU3RhdHVzIiwiZG9jdW1lbnRzIiwicmVxdWlyZWREb2NzIiwidXBsb2FkZWREb2NzIiwibWFwIiwiZG9jIiwiaGFzQWxsRG9jcyIsImV2ZXJ5Iiwic29tZSIsInVwbG9hZGVkIiwidG9VcHBlckNhc2UiLCJjbGllbnRTdGF0ZSIsImlzVmVyaWZpZWQiLCJ2ZXJpZmllZCIsImdldE1hbWJ1S1lDU3RhdHVzQnlFbWFpbCIsImt5Y1N0YXR1cyIsImlzTWFtYnVDb25maWd1cmVkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/mambu.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmambu%2Faccount%2Froute&page=%2Fapi%2Fmambu%2Faccount%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmambu%2Faccount%2Froute.ts&appDir=%2FUsers%2Femretutkun%2FDocuments%2FGitHub%2F101010%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Femretutkun%2FDocuments%2FGitHub%2F101010&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();